<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RRB NTPC Syllabus Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ===== CSS Variables for Themes ===== */
    :root {
      /* Dark Theme (Default) */
      --bg: #0f172a;
      --glass: rgba(255,255,255,0.08);
      --card: #1e293b;
      --text: #f1f5f9;
      --muted: #94a3b8;
      --border: #334155;
      --accent: #6366f1;
      --accent-2: #ec4899;
      --accent-3: #10b981;
      --accent-4: #f59e0b;
      --accent-5: #8b5cf6;
      --pill: #1a2437;
      --shadow: 0 12px 35px rgba(0,0,0,0.4);
      --gradient: linear-gradient(135deg, #6366f1, #ec4899, #f59e0b, #10b981);
      --gradient-card: linear-gradient(145deg, #1e293b, #1a2437);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --drawer-bg: rgba(15, 23, 42, 0.95);
    }
    
    /* Light Theme */
    .theme-light {
      --bg: #f8fafc;
      --glass: rgba(15, 23, 42, 0.05);
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e2e8f0;
      --accent: #4f46e5;
      --accent-2: #db2777;
      --accent-3: #059669;
      --accent-4: #d97706;
      --accent-5: #7c3aed;
      --pill: #f1f5f9;
      --shadow: 0 12px 35px rgba(0,0,0,0.08);
      --gradient: linear-gradient(135deg, #4f46e5, #db2777, #d97706, #059669);
      --gradient-card: linear-gradient(145deg, #ffffff, #f8fafc);
      --success: #059669;
      --warning: #d97706;
      --danger: #dc2626;
      --drawer-bg: rgba(255, 255, 255, 0.98);
    }
    
    /* Blue Theme */
    .theme-blue {
      --bg: #0c4a6e;
      --glass: rgba(255,255,255,0.1);
      --card: #1e3a5f;
      --text: #e0f2fe;
      --muted: #bae6fd;
      --border: #1e40af;
      --accent: #38bdf8;
      --accent-2: #818cf8;
      --accent-3: #22d3ee;
      --accent-4: #60a5fa;
      --accent-5: #3b82f6;
      --pill: #1e3a8a;
      --shadow: 0 12px 35px rgba(14, 165, 233, 0.2);
      --gradient: linear-gradient(135deg, #38bdf8, #818cf8, #60a5fa, #22d3ee);
      --gradient-card: linear-gradient(145deg, #1e3a5f, #1e3a8a);
      --success: #22d3ee;
      --warning: #fbbf24;
      --danger: #fb7185;
      --drawer-bg: rgba(12, 74, 110, 0.95);
    }
    
    /* Green Theme */
    .theme-green {
      --bg: #064e3b;
      --glass: rgba(255,255,255,0.08);
      --card: #065f46;
      --text: #d1fae5;
      --muted: #a7f3d0;
      --border: #047857;
      --accent: #10b981;
      --accent-2: #34d399;
      --accent-3: #22c55e;
      --accent-4: #84cc16;
      --accent-5: #059669;
      --pill: #064e3b;
      --shadow: 0 12px 35px rgba(16, 185, 129, 0.2);
      --gradient: linear-gradient(135deg, #10b981, #34d399, #84cc16, #22c55e);
      --gradient-card: linear-gradient(145deg, #065f46, #064e3b);
      --success: #34d399;
      --warning: #fbbf24;
      --danger: #f87171;
      --drawer-bg: rgba(6, 78, 59, 0.95);
    }
    
    /* Pink Theme */
    .theme-pink {
      --bg: #831843;
      --glass: rgba(255,255,255,0.1);
      --card: #9d174d;
      --text: #fce7f3;
      --muted: #fbcfe8;
      --border: #be185d;
      --accent: #ec4899;
      --accent-2: #f472b6;
      --accent-3: #f9a8d4;
      --accent-4: #db2777;
      --accent-5: #be185d;
      --pill: #831843;
      --shadow: 0 12px 35px rgba(236, 72, 153, 0.2);
      --gradient: linear-gradient(135deg, #ec4899, #f472b6, #f9a8d4, #db2777);
      --gradient-card: linear-gradient(145deg, #9d174d, #831843);
      --success: #34d399;
      --warning: #fbbf24;
      --danger: #f87171;
      --drawer-bg: rgba(131, 24, 67, 0.95);
    }
    
    /* ===== Base Styles ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
      height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      transition: background-color 0.5s ease, color 0.3s ease;
    }
    
    body {
      background-color: var(--bg);
      color: var(--text);
      overflow-x: hidden;
      position: relative;
    }
    
    /* ===== Welcome Screen ===== */
    #welcomeScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 80%, rgba(99,102,241,0.2) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(16,185,129,0.2) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(245,158,11,0.15) 0%, transparent 50%),
        linear-gradient(135deg, var(--bg) 0%, color-mix(in srgb, var(--bg) 80%, black) 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: opacity 0.8s ease, visibility 0.8s ease;
    }
    
    #welcomeScreen.hidden {
      opacity: 0;
      visibility: hidden;
    }
    
    .welcome-content {
      text-align: center;
      max-width: 800px;
      padding: 50px;
      background: rgba(30, 41, 59, 0.85);
      backdrop-filter: blur(20px);
      border-radius: 28px;
      border: 1px solid rgba(99,102,241,0.3);
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
      position: relative;
      overflow: hidden;
    }
    
    .theme-light .welcome-content,
    .theme-blue .welcome-content,
    .theme-green .welcome-content,
    .theme-pink .welcome-content {
      background: rgba(255, 255, 255, 0.85);
    }
    
    .welcome-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: var(--gradient);
    }
    
    .welcome-logo {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: var(--gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 30px;
      font-size: 4rem;
      box-shadow: 0 20px 40px rgba(99,102,241,0.5);
      animation: pulse 2.5s infinite;
      border: 5px solid rgba(255, 255, 255, 0.2);
      overflow: hidden;
    }
    
    .welcome-logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 15px 35px rgba(99,102,241,0.5); }
      50% { transform: scale(1.05); box-shadow: 0 25px 50px rgba(99,102,241,0.7); }
      100% { transform: scale(1); box-shadow: 0 15px 35px rgba(99,102,241,0.5); }
    }
    
    .welcome-content h1 {
      font-size: 3.2rem;
      margin: 0 0 20px;
      background: var(--gradient);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 900;
      letter-spacing: -0.5px;
    }
    
    .welcome-content p {
      color: var(--muted);
      font-size: 1.3rem;
      line-height: 1.7;
      margin-bottom: 30px;
    }
    
    .name-input {
      width: 100%;
      padding: 18px 24px;
      margin: 20px 0;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(99,102,241,0.3);
      border-radius: 16px;
      color: var(--text);
      font-size: 1.2rem;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .name-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(99,102,241,0.3);
      background: rgba(255, 255, 255, 0.15);
    }
    
    .welcome-btn {
      background: var(--gradient);
      color: white;
      border: none;
      padding: 20px 50px;
      font-size: 1.4rem;
      font-weight: 700;
      border-radius: 16px;
      cursor: pointer;
      box-shadow: 0 15px 35px rgba(99,102,241,0.5);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      margin-top: 10px;
    }
    
    .welcome-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 50px rgba(99,102,241,0.6);
    }
    
    /* ===== Header / Navigation ===== */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(12px);
      background: linear-gradient(180deg, rgba(15,23,42,0.9), rgba(15,23,42,0.7));
      border-bottom: 1px solid var(--border);
      padding: 0 20px;
    }
    
    .theme-light header,
    .theme-blue header,
    .theme-green header,
    .theme-pink header {
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
    }
    
    .nav-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1200px;
      margin: 0 auto;
      padding: 15px 0;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .logo {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: conic-gradient(from 220deg, var(--accent), var(--accent-3), var(--accent-4), var(--accent-2));
      box-shadow: 0 8px 25px rgba(99,102,241,0.4);
      overflow: hidden;
    }
    
    .logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 16px;
    }
    
    .titles h1 {
      margin: 0;
      font-size: 1.5rem;
      letter-spacing: 0.2px;
      background: var(--gradient);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 800;
    }
    
    .titles p {
      margin: 4px 0 0;
      color: var(--muted);
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .greeting {
      font-weight: 700;
      color: var(--accent);
    }
    
    .nav-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .nav-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border);
      color: var(--text);
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.2rem;
    }
    
    .nav-btn:hover {
      background: var(--accent);
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    
    /* ===== Drawer Menu ===== */
    .drawer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .drawer-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .drawer {
      position: fixed;
      top: 0;
      right: -400px;
      width: 380px;
      max-width: 90%;
      height: 100%;
      background: var(--drawer-bg);
      backdrop-filter: blur(20px);
      z-index: 1000;
      overflow-y: auto;
      transition: right 0.4s cubic-bezier(0.22, 0.61, 0.36, 1);
      box-shadow: -10px 0 40px rgba(0,0,0,0.3);
      border-left: 1px solid var(--border);
    }
    
    .drawer.active {
      right: 0;
    }
    
    .drawer-header {
      padding: 25px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .drawer-header h2 {
      font-size: 1.5rem;
      background: var(--gradient);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .drawer-close {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s ease;
    }
    
    .drawer-close:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .drawer-content {
      padding: 25px;
    }
    
    .drawer-section {
      margin-bottom: 30px;
    }
    
    .drawer-section h3 {
      font-size: 1.1rem;
      margin-bottom: 15px;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .drawer-section h3 i {
      font-size: 1.2rem;
    }
    
    .theme-selector {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    
    .theme-btn {
      padding: 12px;
      border-radius: 12px;
      border: 2px solid var(--border);
      background: var(--card);
      color: var(--text);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }
    
    .theme-btn.active {
      border-color: var(--accent);
      box-shadow: 0 5px 15px rgba(99,102,241,0.3);
    }
    
    .social-links {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .social-link {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      text-decoration: none;
      color: var(--text);
      transition: all 0.3s ease;
    }
    
    .social-link:hover {
      background: var(--accent);
      transform: translateX(5px);
    }
    
    .social-link i {
      font-size: 1.3rem;
      width: 30px;
    }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .drawer-btn {
      padding: 15px;
      border-radius: 12px;
      border: none;
      background: rgba(255,255,255,0.1);
      color: var(--text);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .drawer-btn:hover {
      background: var(--accent);
      transform: translateX(5px);
    }
    
    .drawer-btn.danger {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }
    
    .drawer-btn.danger:hover {
      background: var(--danger);
      color: white;
    }
    
    /* ===== Main Container ===== */
    .container {
      max-width: 1200px;
      margin: 30px auto;
      padding: 0 20px;
    }
    
    /* ===== Tabs ===== */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      overflow-x: auto;
      padding-bottom: 10px;
    }
    
    .tab-btn {
      padding: 15px 25px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      font-weight: 600;
    }
    
    .tab-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      box-shadow: 0 8px 20px rgba(99,102,241,0.3);
    }
    
    .tab-btn:hover:not(.active) {
      background: rgba(255,255,255,0.1);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* ===== Grid Layout ===== */
    .grid {
      display: grid;
      gap: 25px;
      grid-template-columns: 1fr 1fr;
    }
    
    @media (max-width: 992px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
    
    /* ===== Cards ===== */
    .card {
      background: var(--gradient-card);
      border: 1px solid var(--border);
      border-radius: 20px;
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: var(--gradient);
    }
    
    .card h2 {
      margin: 0;
      padding: 20px 25px;
      font-size: 1.3rem;
      background: linear-gradient(180deg, rgba(255,255,255,0.08), transparent);
      border-bottom: 1px solid var(--border);
      font-weight: 800;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .card .body {
      padding: 20px;
    }
    
    /* ===== Subjects List ===== */
    .subject {
      margin-bottom: 25px;
      border: 1px solid var(--border);
      border-radius: 18px;
      overflow: hidden;
      background: linear-gradient(180deg, rgba(255,255,255,0.05), transparent);
    }
    
    .subject-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 20px;
      background: var(--pill);
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    .subject-header:hover {
      background: color-mix(in srgb, var(--pill) 90%, white);
    }
    
    .subject-title {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    
    .badge {
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 0.85rem;
      color: #0f172a;
      font-weight: 800;
      background: white;
    }
    
    .badge.math { background: var(--accent); }
    .badge.reasoning { background: var(--accent-3); }
    .badge.history { background: #f59e0b; }
    .badge.polity { background: #ec4899; }
    .badge.geography { background: #8b5cf6; }
    .badge.economy { background: #10b981; }
    .badge.static-gk { background: #06b6d4; }
    .badge.science { background: #f97316; }
    .badge.computer { background: #6366f1; }
    
    .progress-wrap {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    
    .progress-bar {
      height: 12px;
      width: 200px;
      background: rgba(0,0,0,0.2);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
    }
    
    @media (max-width: 768px) {
      .progress-bar {
        width: 120px;
      }
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-3));
      width: 0%;
      transition: width 1s cubic-bezier(0.22, 0.61, 0.36, 1);
    }
    
    .percent {
      font-size: 0.95rem;
      color: var(--muted);
      width: 60px;
      text-align: right;
      font-weight: 700;
    }
    
    .topics {
      padding: 15px 20px;
      display: grid;
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .topic {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 15px;
      border-radius: 16px;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }
    
    .topic:hover {
      background: rgba(255,255,255,0.08);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    
    .topic input {
      width: 22px;
      height: 22px;
      cursor: pointer;
      transform: translateY(3px);
      accent-color: var(--accent);
    }
    
    .topic label {
      cursor: pointer;
      line-height: 1.5;
      flex: 1;
    }
    
    .topic small {
      display: block;
      color: var(--muted);
      margin-top: 8px;
      font-size: 0.9rem;
    }
    
    .weight {
      margin-left: auto;
      font-size: 0.85rem;
      color: var(--accent);
      background: rgba(0,0,0,0.2);
      padding: 5px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-weight: 700;
    }
    
    /* Star ratings */
    .stars {
      margin-left: 10px;
      color: #fbbf24;
      font-size: 0.9rem;
    }
    
    .stars.three-stars::after { content: " ★★★"; }
    .stars.two-stars::after { content: " ★★"; }
    .stars.one-star::after { content: " ★"; }
    
    /* ===== Charts ===== */
    .charts {
      display: grid;
      gap: 25px;
      text-align: center;
    }
    
    .overall-chart {
      margin-bottom: 30px;
    }
    
    .overall-donut {
      width: 240px;
      height: 240px;
      display: block;
      margin: 0 auto;
    }
    
    .overall-donut text {
      fill: var(--text);
      font-size: 28px;
      font-weight: 900;
    }
    
    .subject-charts {
      display: flex;
      flex-direction: row;
      justify-content: space-around;
      gap: 20px;
      flex-wrap: wrap;
    }
    
    .chart-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      min-width: 180px;
      padding: 20px;
      border-radius: 18px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .chart-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.3);
    }
    
    .donut {
      width: 120px;
      height: 120px;
    }
    
    .donut text {
      fill: var(--text);
      font-size: 16px;
      font-weight: 800;
    }
    
    .legend {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 15px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
      color: var(--muted);
    }
    
    .dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
    }
    
    .dot.math { background: var(--accent); }
    .dot.reasoning { background: var(--accent-3); }
    .dot.history { background: #f59e0b; }
    .dot.polity { background: #ec4899; }
    .dot.geography { background: #8b5cf6; }
    .dot.economy { background: #10b981; }
    .dot.static-gk { background: #06b6d4; }
    .dot.science { background: #f97316; }
    .dot.computer { background: #6366f1; }
    .dot.todo { background: var(--border); }
    .dot.done { background: var(--accent-3); }
    
    .subject-names {
      margin-top: 8px;
      font-size: 1.1rem;
      font-weight: 800;
      color: var(--accent);
    }
    
    /* ===== CBT Analysis Section ===== */
    .cbt-container {
      display: grid;
      gap: 25px;
      grid-template-columns: 1fr 1fr;
    }
    
    @media (max-width: 768px) {
      .cbt-container {
        grid-template-columns: 1fr;
      }
    }
    
    .cbt-card {
      grid-column: 1 / -1;
    }
    
    .cbt-controls {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    
    .cbt-btn {
      padding: 12px 20px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }
    
    .cbt-btn.active {
      background: var(--accent);
      border-color: var(--accent);
    }
    
    .cbt-form {
      display: grid;
      gap: 15px;
      margin-top: 20px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .form-group label {
      font-weight: 600;
      color: var(--muted);
    }
    
    .form-group input, .form-group select {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      font-size: 1rem;
    }
    
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(99,102,241,0.2);
    }
    
    /* ===== Congratulations Modal ===== */
    .congrats-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    
    .congrats-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .congrats-content {
      background: var(--gradient-card);
      border-radius: 24px;
      padding: 40px;
      text-align: center;
      max-width: 500px;
      width: 90%;
      border: 1px solid var(--border);
      box-shadow: 0 30px 60px rgba(0,0,0,0.5);
      position: relative;
      overflow: hidden;
    }
    
    .congrats-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: var(--gradient);
    }
    
    .congrats-icon {
      font-size: 5rem;
      margin-bottom: 20px;
      background: var(--gradient);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .congrats-content h2 {
      font-size: 2.2rem;
      margin-bottom: 15px;
      background: var(--gradient);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .congrats-content p {
      color: var(--muted);
      font-size: 1.2rem;
      margin-bottom: 25px;
      line-height: 1.6;
    }
    
    .close-congrats {
      padding: 12px 30px;
      background: var(--accent);
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    
    .close-congrats:hover {
      transform: translateY(-3px);
    }
    
    /* ===== Controls ===== */
    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    
    button {
      padding: 14px 22px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .btn-primary {
      background: var(--gradient);
      color: white;
    }
    
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: var(--text);
      border: 1px solid var(--border);
    }
    
    .btn-danger {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
      border: 1px solid var(--danger);
    }
    
    .btn-danger:hover {
      background: var(--danger);
      color: white;
    }
    
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    
    .note {
      color: var(--muted);
      font-size: 0.95rem;
      margin-top: 15px;
      font-style: italic;
    }
    
    /* ===== Motivational Message ===== */
    .motivational-message {
      text-align: center;
      margin: 20px 0;
      padding: 15px;
      background: rgba(99,102,241,0.1);
      border-radius: 16px;
      border-left: 5px solid var(--accent);
      font-style: italic;
      font-size: 1.1rem;
    }
    
    /* ===== Footer ===== */
    footer {
      margin: 40px auto;
      max-width: 1200px;
      padding: 0 20px;
      color: var(--muted);
      font-size: 0.95rem;
      text-align: center;
      padding: 25px;
      border-top: 1px solid var(--border);
    }
    
    .creator {
      font-weight: 800;
      color: var(--accent);
    }
    
    /* ===== Reset Confirmation ===== */
    .reset-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    
    .reset-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .reset-content {
      background: var(--gradient-card);
      border-radius: 24px;
      padding: 40px;
      text-align: center;
      max-width: 500px;
      width: 90%;
      border: 1px solid var(--border);
      box-shadow: 0 30px 60px rgba(0,0,0,0.5);
    }
    
    .reset-content h2 {
      font-size: 1.8rem;
      margin-bottom: 15px;
      color: var(--danger);
    }
    
    .reset-content p {
      color: var(--muted);
      margin-bottom: 25px;
      line-height: 1.6;
    }
    
    .reset-confirm-input {
      padding: 12px 16px;
      border-radius: 12px;
      border: 2px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      font-size: 1rem;
      width: 100%;
      margin-bottom: 20px;
    }
    
    .reset-confirm-input:focus {
      outline: none;
      border-color: var(--danger);
    }
    
    .reset-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
    }
    
    /* ===== Print Styles ===== */
    @media print {
      .drawer, .nav-controls, .tabs, .cbt-form, .controls button:not(.print-btn) {
        display: none !important;
      }
      
      .card {
        box-shadow: none;
        border: 1px solid #ccc;
      }
      
      body {
        background: white;
        color: black;
      }
    }
    
    /* ===== Responsive Adjustments ===== */
    @media (max-width: 768px) {
      .welcome-content {
        padding: 30px 20px;
        margin: 20px;
      }
      
      .welcome-content h1 {
        font-size: 2.2rem;
      }
      
      .welcome-content p {
        font-size: 1.1rem;
      }
      
      .titles h1 {
        font-size: 1.2rem;
      }
      
      .grid {
        gap: 20px;
      }
      
      .drawer {
        width: 320px;
      }
      
      .tab-btn {
        padding: 12px 18px;
        font-size: 0.9rem;
      }
      
      .subject-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .progress-wrap {
        width: 100%;
        justify-content: space-between;
      }
    }
    
    @media (max-width: 480px) {
      .nav-container {
        padding: 10px 0;
      }
      
      .logo {
        width: 50px;
        height: 50px;
      }
      
      .titles h1 {
        font-size: 1rem;
      }
      
      .nav-btn {
        width: 45px;
        height: 45px;
      }
      
      .container {
        padding: 0 15px;
      }
    }
  </style>
</head>
<body class="theme-dark">
  <!-- Welcome Screen -->
  <div id="welcomeScreen">
    <div class="welcome-content">
      <div class="welcome-logo">
        <img src="https://image2url.com/images/1765963464649-16fe2bee-cc47-4d16-b4ae-96e40492943d.png" alt="RRB NTPC Logo">
      </div>
      <h1>RRB NTPC Syllabus Tracker</h1>
      <p>अपनी RRB NTPC परीक्षा की तैयारी को व्यवस्थित और ट्रैक करें। विषय-वार प्रगति देखें, CBT परीक्षा का विश्लेषण करें और अपने अध्ययन को बेहतर बनाएं।</p>
      
      <input type="text" class="name-input" id="studentName" placeholder="अपना नाम दर्ज करें (उदा: राहुल शर्मा)" maxlength="30">
      
      <button class="welcome-btn" id="startTracking">
        <i class="fas fa-chart-line"></i> Track Your Progress
      </button>
      <p style="margin-top: 20px; color: var(--muted); font-size: 0.9rem;">डेटा आपके डिवाइस पर सुरक्षित रहेगा। आप इसे कभी भी एक्सपोर्ट/इम्पोर्ट कर सकते हैं।</p>
    </div>
  </div>
  
  <!-- Drawer Overlay -->
  <div class="drawer-overlay" id="drawerOverlay"></div>
  
  <!-- Drawer Menu -->
  <div class="drawer" id="drawer">
    <div class="drawer-header">
      <h2><i class="fas fa-bars"></i> मेनू</h2>
      <button class="drawer-close" id="drawerClose">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="drawer-content">
      <div class="drawer-section">
        <h3><i class="fas fa-palette"></i> थीम</h3>
        <div class="theme-selector">
          <button class="theme-btn active" data-theme="dark">डार्क</button>
          <button class="theme-btn" data-theme="light">लाइट</button>
          <button class="theme-btn" data-theme="blue">ब्लू</button>
          <button class="theme-btn" data-theme="green">ग्रीन</button>
          <button class="theme-btn" data-theme="pink">पिंक</button>
        </div>
      </div>
      
      <div class="drawer-section">
        <h3><i class="fas fa-share-alt"></i> शेयर करें</h3>
        <div class="social-links">
          <a href="https://skpro7.github.io/ntpc/" class="social-link" target="_blank">
            <i class="fab fa-github"></i>
            <div>
              <strong>GitHub पर देखें</strong>
              <small>सोर्स कोड और अपडेट</small>
            </div>
          </a>
          <a href="https://t.me/shailuk7" class="social-link" target="_blank">
            <i class="fab fa-telegram"></i>
            <div>
              <strong>Telegram पर क्वेरी</strong>
              <small>सहायता और अपडेट के लिए</small>
            </div>
          </a>
        </div>
      </div>
      
      <div class="drawer-section">
        <h3><i class="fas fa-cog"></i> सेटिंग्स</h3>
        <div class="btn-group">
          <button class="drawer-btn" id="exportBackupBtn">
            <i class="fas fa-file-export"></i> बैकअप एक्सपोर्ट करें
          </button>
          <button class="drawer-btn" id="importBackupBtn">
            <i class="fas fa-file-import"></i> बैकअप इम्पोर्ट करें
          </button>
          <button class="drawer-btn" onclick="window.print()">
            <i class="fas fa-print"></i> प्रिंट / PDF सेव करें
          </button>
          <button class="drawer-btn danger" id="resetBtn">
            <i class="fas fa-trash-alt"></i> प्रोग्रेस रीसेट करें
          </button>
        </div>
      </div>
      
      <div class="drawer-section">
        <h3><i class="fas fa-info-circle"></i> जानकारी</h3>
        <p style="color: var(--muted); font-size: 0.95rem; line-height: 1.6;">
          यह टूल RRB NTPC परीक्षा की तैयारी करने वाले उम्मीदवारों के लिए बनाया गया है। 
          आप अपनी प्रगति ट्रैक कर सकते हैं, विषयवार विश्लेषण देख सकते हैं और CBT परीक्षा का मूल्यांकन कर सकते हैं।
        </p>
        <p style="color: var(--accent); margin-top: 15px; font-weight: 600;">
          <i class="fas fa-heart"></i> Created by: Mr. SHAILENDRA KUSHWAH
        </p>
      </div>
    </div>
  </div>
  
  <!-- Reset Confirmation Modal -->
  <div class="reset-modal" id="resetModal">
    <div class="reset-content">
      <h2><i class="fas fa-exclamation-triangle"></i> प्रोग्रेस रीसेट करें</h2>
      <p>क्या आप वाकई सभी टॉपिक्स और प्रोग्रेस को रीसेट करना चाहते हैं? यह एक्शन पूर्ववत नहीं किया जा सकता।</p>
      <p>पुष्टि करने के लिए नीचे दिए गए बॉक्स में <strong>"RESET MY PROGRESS"</strong> टाइप करें:</p>
      <input type="text" class="reset-confirm-input" id="resetConfirmInput" placeholder='यहां "RESET MY PROGRESS" टाइप करें'>
      <div class="reset-buttons">
        <button class="btn-secondary" id="resetCancel">कैंसल</button>
        <button class="btn-danger" id="resetConfirm" disabled>रीसेट करें</button>
      </div>
    </div>
  </div>
  
  <!-- Congratulations Modal -->
  <div class="congrats-modal" id="congratsModal">
    <div class="congrats-content">
      <div class="congrats-icon">
        <i class="fas fa-trophy"></i>
      </div>
      <h2>बधाई हो!</h2>
      <p id="congratsMessage">आपने एक टॉपिक पूरा किया है! आपकी मेहनत आपको सफलता दिलाएगी।</p>
      <button class="close-congrats" id="closeCongrats">जारी रखें</button>
    </div>
  </div>
  
  <!-- Main App -->
  <div id="mainApp" style="display: none;">
    <header>
      <div class="nav-container">
        <div class="brand">
          <div class="logo">
            <img src="https://image2url.com/images/1765963464649-16fe2bee-cc47-4d16-b4ae-96e40492943d.png" alt="RRB NTPC Logo">
          </div>
          <div class="titles">
            <h1>RRB NTPC Syllabus Tracker</h1>
            <p><span class="greeting" id="greetingText">Welcome</span> | Tick topics to update graphs. Progress auto-saves.</p>
          </div>
        </div>
        <div class="nav-controls">
          <button class="nav-btn" id="menuBtn">
            <i class="fas fa-bars"></i>
          </button>
          <button class="nav-btn" id="themeToggle">
            <i class="fas fa-moon"></i>
          </button>
        </div>
      </div>
    </header>
    
    <div class="container">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="syllabus">सिलेबस ट्रैकर</button>
        <button class="tab-btn" data-tab="cbt-analysis">CBT विश्लेषण</button>
        <button class="tab-btn" data-tab="performance">प्रदर्शन ग्राफ</button>
      </div>
      
      <!-- Syllabus Tab -->
      <div class="tab-content active" id="syllabus-tab">
        <div class="motivational-message" id="motivationalMessage">
          आपकी सफलता की यात्रा आज से शुरू होती है! हर दिन थोड़ा पढ़ें, सफलता आपके कदम चूमेगी!
        </div>
        
        <div class="grid">
          <!-- Subjects List -->
          <div class="card">
            <h2>विषय और टॉपिक्स <span id="totalProgress">(0% पूर्ण)</span></h2>
            <div class="body">
              <div id="subjectsContainer"></div>
              <div class="controls">
                <button class="btn-primary" id="expandAll">
                  <i class="fas fa-expand-alt"></i> सभी एक्सपैंड करें
                </button>
                <button class="btn-secondary" id="collapseAll">
                  <i class="fas fa-compress-alt"></i> सभी कोलैप्स करें
                </button>
                <button class="btn-secondary" id="markAll">
                  <i class="fas fa-check-double"></i> सभी मार्क करें
                </button>
                <button class="btn-secondary" id="unmarkAll">
                  <i class="fas fa-undo"></i> सभी अनमार्क करें
                </button>
              </div>
            </div>
          </div>
          
          <!-- Progress Overview -->
          <div class="card">
            <h2>प्रगति अवलोकन</h2>
            <div class="body charts">
              <div class="overall-chart">
                <svg class="overall-donut" viewBox="0 0 200 200" aria-label="Overall completion donut">
                  <circle cx="100" cy="100" r="85" fill="none" stroke="var(--border)" stroke-width="25"/>
                  <circle id="donutOverall" cx="100" cy="100" r="85" fill="none" stroke="url(#gradOverall)" stroke-width="25" stroke-linecap="round" stroke-dasharray="534" stroke-dashoffset="534"/>
                  <defs>
                    <linearGradient id="gradOverall" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="0%" stop-color="var(--accent)"/>
                      <stop offset="100%" stop-color="var(--accent-3)"/>
                    </linearGradient>
                  </defs>
                  <text x="100" y="105" text-anchor="middle" id="overallText">0%</text>
                </svg>
                <div class="legend">
                  <div class="legend-item"><span class="dot done"></span>पूर्ण</div>
                  <div class="legend-item"><span class="dot todo"></span>शेष</div>
                </div>
                <p class="note">आपके द्वारा टिक किए गए टॉपिक्स के अनुसार समग्र प्रगति अपडेट होती है।</p>
              </div>
              
              <div class="subject-charts" id="subjectCharts">
                <!-- Charts will be dynamically generated -->
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- CBT Analysis Tab -->
      <div class="tab-content" id="cbt-analysis-tab">
        <div class="card">
          <h2>CBT परीक्षा विश्लेषण</h2>
          <div class="body">
            <div class="cbt-controls">
              <button class="cbt-btn active" data-cbt="cbt1">CBT 1</button>
              <button class="cbt-btn" data-cbt="cbt2">CBT 2</button>
              <button class="cbt-btn" data-cbt="full">फुल टेस्ट</button>
            </div>
            
            <div class="cbt-container">
              <div class="card">
                <h3>मार्क्स एंट्री</h3>
                <div class="body">
                  <form class="cbt-form" id="cbtForm">
                    <div class="form-group">
                      <label for="testName">टेस्ट का नाम:</label>
                      <input type="text" id="testName" placeholder="उदा: Mock Test 1, Previous Year Paper" required>
                    </div>
                    
                    <div class="form-group">
                      <label for="testDate">तारीख:</label>
                      <input type="date" id="testDate" required>
                    </div>
                    
                    <div class="form-group">
                      <label for="mathMarks">गणित (अंक):</label>
                      <input type="number" id="mathMarks" min="0" max="100" placeholder="0-100" required>
                    </div>
                    
                    <div class="form-group">
                      <label for="reasoningMarks">रीजनिंग (अंक):</label>
                      <input type="number" id="reasoningMarks" min="0" max="100" placeholder="0-100" required>
                    </div>
                    
                    <div class="form-group">
                      <label for="gsMarks">सामान्य जागरूकता (अंक):</label>
                      <input type="number" id="gsMarks" min="0" max="100" placeholder="0-100" required>
                    </div>
                    
                    <div class="form-group">
                      <label for="totalMarks">कुल अंक:</label>
                      <input type="number" id="totalMarks" min="0" max="300" placeholder="0-300" required>
                    </div>
                    
                    <button type="submit" class="btn-primary">
                      <i class="fas fa-save"></i> सेव करें
                    </button>
                  </form>
                </div>
              </div>
              
              <div class="card">
                <h3>अंतिम प्रदर्शन</h3>
                <div class="body">
                  <div id="latestPerformance">
                    <p style="text-align: center; color: var(--muted); padding: 30px;">अभी तक कोई टेस्ट डेटा नहीं है। पहला टेस्ट एंट्री जोड़ें।</p>
                  </div>
                </div>
              </div>
              
              <div class="card cbt-card">
                <h3>प्रदर्शन ट्रेंड</h3>
                <div class="body">
                  <canvas id="performanceChart" height="250"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Performance Graph Tab -->
      <div class="tab-content" id="performance-tab">
        <div class="card">
          <h2>विस्तृत प्रदर्शन विश्लेषण</h2>
          <div class="body">
            <div class="grid">
              <div class="card">
                <h3>विषयवार प्रगति</h3>
                <div class="body">
                  <canvas id="subjectProgressChart" height="300"></canvas>
                </div>
              </div>
              
              <div class="card">
                <h3>टॉपिक कवरेज</h3>
                <div class="body">
                  <canvas id="topicCoverageChart" height="300"></canvas>
                </div>
              </div>
            </div>
            
            <div class="card" style="margin-top: 25px;">
              <h3>साप्ताहिक अध्ययन ट्रेंड</h3>
              <div class="body">
                <canvas id="studyTrendChart" height="250"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <footer>
      © <span class="creator">Mr. SHAILENDRA KUSHWAH</span> — RRB NTPC Syllabus Tracker 2026. Designed for effective exam preparation. Data is saved locally on your device.
      <p style="margin-top: 10px; font-size: 0.85rem;">
        <i class="fas fa-mobile-alt"></i> मोबाइल फ्रेंडली | <i class="fas fa-cloud-download-alt"></i> ऑफलाइन उपलब्ध | <i class="fas fa-chart-bar"></i> एडवांस्ड एनालिटिक्स
      </p>
    </footer>
  </div>
  
  <!-- Hidden file input for import -->
  <input type="file" id="importFile" accept=".json" style="display:none">
  
  <script>
    // ========== CONFIGURATION ==========
    const CONFIG = {
      brandName: "RRB NTPC Syllabus Tracker",
      appVersion: "2026.1.0",
      
      // Subjects with detailed breakdown
      subjects: [
        {
          id: "math",
          title: "गणित (Mathematics)",
          colorClass: "math",
          weight: 1,
          topics: [
            { id:"numSys", name:"संख्या प्रणाली", hint:"संख्या प्रणाली, दशमलव, भिन्न, लघुत्तम समापवर्त्य और महत्तम समापवर्तक", weight:1, stars: 3 },
            { id:"ratio", name:"अनुपात और समानुपात", hint:"अनुपात और समानुपात", weight:1, stars: 2 },
            { id:"percent", name:"प्रतिशत", hint:"प्रतिशत", weight:1, stars: 3 },
            { id:"mensuration", name:"क्षेत्रमिति", hint:"क्षेत्रमिति", weight:1, stars: 2 },
            { id:"timeWork", name:"समय और कार्य", hint:"समय और कार्य", weight:1, stars: 3 },
            { id:"speedTime", name:"चाल, समय और दूरी", hint:"चाल, समय और दूरी", weight:1, stars: 3 },
            { id:"simpleInterest", name:"साधारण और चक्रवृद्धि ब्याज", hint:"साधारण और चक्रवृद्धि ब्याज", weight:1, stars: 2 },
            { id:"profitLoss", name:"लाभ और हानि", hint:"लाभ और हानि", weight:1, stars: 2 },
            { id:"algebra", name:"प्रारंभिक बीजगणित", hint:"प्रारंभिक बीजगणित", weight:1, stars: 3 },
            { id:"geometry", name:"ज्यामिति", hint:"ज्यामिति", weight:1, stars: 2 },
            { id:"trigonometry", name:"त्रिकोणमिति", hint:"त्रिकोणमिति", weight:1, stars: 1 },
            { id:"statistics", name:"प्रारंभिक सांख्यिकी", hint:"प्रारंभिक सांख्यिकी", weight:1, stars: 1 },
            { id:"dataInterpretation", name:"डाटा इंटरप्रिटेशन", hint:"डाटा इंटरप्रिटेशन", weight:1, stars: 3 },
            { id:"simplification", name:"सरलीकरण", hint:"सरलीकरण", weight:1, stars: 2 }
          ]
        },
        {
          id: "reasoning",
          title: "तार्किक क्षमता (Reasoning)",
          colorClass: "reasoning",
          weight: 1,
          topics: [
            { id:"analogies", name:"सादृश्यता", hint:"सादृश्यता", weight:1, stars: 2 },
            { id:"series", name:"संख्या और वर्णमाला श्रृंखला", hint:"संख्या और वर्णमाला श्रृंखला का पूरा करना", weight:1, stars: 3 },
            { id:"coding", name:"कोडिंग और डिकोडिंग", hint:"कोडिंग और डिकोडिंग", weight:1, stars: 3 },
            { id:"mathOps", name:"गणितीय संचालन", hint:"गणितीय संचालन", weight:1, stars: 2 },
            { id:"similarities", name:"समानता और अंतर", hint:"समानता और अंतर", weight:1, stars: 1 },
            { id:"relationships", name:"संबंध", hint:"संबंध", weight:1, stars: 1 },
            { id:"analytical", name:"विश्लेषणात्मक तर्क", hint:"विश्लेषणात्मक तर्क", weight:1, stars: 3 },
            { id:"syllogism", name:"न्यायवाक्य", hint:"न्यायवाक्य", weight:1, stars: 3 },
            { id:"jumbling", name:"जंबलिंग", hint:"जंबलिंग", weight:1, stars: 2 },
            { id:"venn", name:"वेन आरेख", hint:"वेन आरेख", weight:1, stars: 2 },
            { id:"puzzle", name:"पहेली", hint:"पहेली", weight:1, stars: 3 },
            { id:"dataSuff", name:"डाटा पर्याप्तता", hint:"डाटा पर्याप्तता", weight:1, stars: 2 },
            { id:"statementConcl", name:"कथन-निष्कर्ष", hint:"कथन-निष्कर्ष", weight:1, stars: 2 },
            { id:"coursesAction", name:"कार्रवाई के पाठ्यक्रम", hint:"कथन: कार्रवाई के पाठ्यक्रम", weight:1, stars: 1 },
            { id:"decisionMaking", name:"निर्णय लेना", hint:"निर्णय लेना", weight:1, stars: 1 },
            { id:"maps", name:"मानचित्र", hint:"मानचित्र", weight:1, stars: 1 },
            { id:"graphs", name:"ग्राफ की व्याख्या", hint:"ग्राफ की व्याख्या", weight:1, stars: 2 }
          ]
        },
        {
          id: "history",
          title: "भारतीय इतिहास (History)",
          colorClass: "history",
          weight: 1,
          topics: [
            { id:"ancientHistory", name:"प्राचीन भारतीय इतिहास", hint:"सिंधु घाटी सभ्यता, वैदिक काल, मौर्य साम्राज्य, गुप्त साम्राज्य", weight:1, stars: 2 },
            { id:"medievalHistory", name:"मध्यकालीन भारतीय इतिहास", hint:"दिल्ली सल्तनत, मुगल साम्राज्य, विजयनगर साम्राज्य, मराठा साम्राज्य", weight:1, stars: 2 },
            { id:"modernHistory", name:"आधुनिक भारतीय इतिहास", hint:"ब्रिटिश शासन, 1857 का विद्रोह, भारतीय राष्ट्रीय आंदोलन, स्वतंत्रता", weight:1, stars: 3 },
            { id:"freedomStruggle", name:"स्वतंत्रता संग्राम", hint:"भारतीय स्वतंत्रता संग्राम के प्रमुख घटनाएं और नेता", weight:1, stars: 3 },
            { id:"indianCulture", name:"भारतीय कला और संस्कृति", hint:"भारतीय कला, संस्कृति, वास्तुकला और त्योहार", weight:1, stars: 2 },
            { id:"worldHistory", name:"विश्व इतिहास", hint:"विश्व इतिहास की प्रमुख घटनाएं", weight:1, stars: 1 }
          ]
        },
        {
          id: "polity",
          title: "भारतीय राजव्यवस्था (Polity)",
          colorClass: "polity",
          weight: 1,
          topics: [
            { id:"constitution", name:"भारतीय संविधान", hint:"संविधान का निर्माण, प्रस्तावना, मूल अधिकार और कर्तव्य", weight:1, stars: 3 },
            { id:"politicalSystem", name:"राजनीतिक व्यवस्था", hint:"संसद, राष्ट्रपति, प्रधानमंत्री, मंत्रिमंडल", weight:1, stars: 3 },
            { id:"judiciary", name:"न्यायपालिका", hint:"सर्वोच्च न्यायालय, उच्च न्यायालय, न्यायिक व्यवस्था", weight:1, stars: 2 },
            { id:"centralState", name:"केंद्र-राज्य संबंध", hint:"केंद्र और राज्य सरकारों के बीच संबंध", weight:1, stars: 2 },
            { id:"localGovt", name:"स्थानीय शासन", hint:"पंचायती राज, नगर निगम", weight:1, stars: 1 },
            { id:"constitutionalBodies", name:"संवैधानिक निकाय", hint:"चुनाव आयोग, यूपीएससी, सीएजी", weight:1, stars: 2 }
          ]
        },
        {
          id: "geography",
          title: "भूगोल (Geography)",
          colorClass: "geography",
          weight: 1,
          topics: [
            { id:"physicalGeo", name:"भौतिक भूगोल", hint:"पर्वत, पठार, मैदान, नदियाँ, जलवायु", weight:1, stars: 3 },
            { id:"indianGeo", name:"भारत का भूगोल", hint:"भारत की भौगोलिक विशेषताएं, राज्य और राजधानियाँ", weight:1, stars: 3 },
            { id:"worldGeo", name:"विश्व भूगोल", hint:"महाद्वीप, महासागर, महत्वपूर्ण स्थान", weight:1, stars: 2 },
            { id:"economicGeo", name:"आर्थिक भूगोल", hint:"कृषि, खनिज, उद्योग, परिवहन", weight:1, stars: 2 },
            { id:"environment", name:"पर्यावरण और पारिस्थितिकी", hint:"पर्यावरणीय मुद्दे, संरक्षण, राष्ट्रीय उद्यान", weight:1, stars: 2 },
            { id:"disasterMgmt", name:"आपदा प्रबंधन", hint:"प्राकृतिक आपदाएं और उनका प्रबंधन", weight:1, stars: 1 }
          ]
        },
        {
          id: "economy",
          title: "अर्थव्यवस्था (Economy)",
          colorClass: "economy",
          weight: 1,
          topics: [
            { id:"basicConcepts", name:"अर्थव्यवस्था के मूल सिद्धांत", hint:"मांग और आपूर्ति, मुद्रास्फीति, बेरोजगारी", weight:1, stars: 3 },
            { id:"indianEconomy", name:"भारतीय अर्थव्यवस्था", hint:"योजना, बजट, बैंकिंग, कर व्यवस्था", weight:1, stars: 3 },
            { id:"economicTerms", name:"आर्थिक शब्दावली", hint:"जीडीपी, जीएनपी, रेपो दर, रिवर्स रेपो", weight:1, stars: 2 },
            { id:"agriculture", name:"कृषि और ग्रामीण विकास", hint:"कृषि नीतियां, हरित क्रांति", weight:1, stars: 2 },
            { id:"industry", name:"उद्योग और बुनियादी ढांचा", hint:"औद्योगिक नीतियां, बुनियादी ढांचा परियोजनाएं", weight:1, stars: 2 },
            { id:"internationalEco", name:"अंतर्राष्ट्रीय अर्थव्यवस्था", hint:"विश्व बैंक, आईएमएफ, विश्व व्यापार संगठन", weight:1, stars: 1 }
          ]
        },
        {
          id: "static-gk",
          title: "स्थैतिक सामान्य ज्ञान (Static GK)",
          colorClass: "static-gk",
          weight: 1,
          topics: [
            { id:"awards", name:"पुरस्कार और सम्मान", hint:"भारत रत्न, पद्म पुरस्कार, नोबेल पुरस्कार", weight:1, stars: 2 },
            { id:"booksAuthors", name:"पुस्तकें और लेखक", hint:"प्रसिद्ध पुस्तकें और उनके लेखक", weight:1, stars: 2 },
            { id:"importantDays", name:"महत्वपूर्ण दिवस", hint:"राष्ट्रीय और अंतर्राष्ट्रीय दिवस", weight:1, stars: 1 },
            { id:"sports", name:"खेल", hint:"खेल प्रतियोगिताएं, पुरस्कार, खिलाड़ी", weight:1, stars: 1 },
            { id:"inventions", name:"आविष्कार और आविष्कारक", hint:"महत्वपूर्ण आविष्कार और आविष्कारक", weight:1, stars: 1 },
            { id:"capitalsCurrencies", name:"राजधानियाँ और मुद्राएँ", hint:"देशों की राजधानियाँ और मुद्राएँ", weight:1, stars: 2 },
            { id:"organizations", name:"संगठन और मुख्यालय", hint:"राष्ट्रीय और अंतर्राष्ट्रीय संगठन", weight:1, stars: 2 }
          ]
        },
        {
          id: "science",
          title: "विज्ञान (Science)",
          colorClass: "science",
          weight: 1,
          topics: [
            { id:"physics", name:"भौतिक विज्ञान", hint:"यांत्रिकी, प्रकाशिकी, बिजली, चुंबकत्व", weight:1, stars: 3 },
            { id:"chemistry", name:"रसायन विज्ञान", hint:"तत्व, यौगिक, अम्ल, क्षार, लवण", weight:1, stars: 2 },
            { id:"biology", name:"जीव विज्ञान", hint:"मानव शरीर, पौधे, जानवर, पारिस्थितिकी", weight:1, stars: 3 },
            { id:"everydayScience", name:"दैनिक विज्ञान", hint:"दैनिक जीवन में विज्ञान", weight:1, stars: 2 },
            { id:"sciInventions", name:"वैज्ञानिक आविष्कार", hint:"महत्वपूर्ण वैज्ञानिक आविष्कार", weight:1, stars: 1 },
            { id:"scientists", name:"वैज्ञानिक और उनका योगदान", hint:"प्रसिद्ध वैज्ञानिक और उनका योगदान", weight:1, stars: 1 }
          ]
        },
        {
          id: "computer",
          title: "कंप्यूटर (Computer)",
          colorClass: "computer",
          weight: 1,
          topics: [
            { id:"computerFundamentals", name:"कंप्यूटर मूल बातें", hint:"हार्डवेयर, सॉफ्टवेयर, ऑपरेटिंग सिस्टम", weight:1, stars: 3 },
            { id:"msOffice", name:"एमएस ऑफिस", hint:"वर्ड, एक्सेल, पावरपॉइंट", weight:1, stars: 2 },
            { id:"internet", name:"इंटरनेट और नेटवर्किंग", hint:"इंटरनेट, ईमेल, सोशल मीडिया", weight:1, stars: 2 },
            { id:"abbreviations", name:"कंप्यूटर संक्षिप्त रूप", hint:"कंप्यूटर से संबंधित संक्षिप्त रूप", weight:1, stars: 1 },
            { id:"cyberSecurity", name:"साइबर सुरक्षा", hint:"वायरस, हैकिंग, डाटा सुरक्षा", weight:1, stars: 1 },
            { id:"emergingTech", name:"उभरती प्रौद्योगिकियाँ", hint:"आर्टिफिशियल इंटेलिजेंस, ब्लॉकचेन, IoT", weight:1, stars: 1 }
          ]
        }
      ],
      
      // Motivational messages
      motivationalMessages: [
        "आपकी सफलता की यात्रा आज से शुरू होती है!",
        "हर दिन थोड़ा पढ़ें, सफलता आपके कदम चूमेगी!",
        "मेहनत करने वालों की कभी हार नहीं होती!",
        "सपने वो नहीं जो आप सोते समय देखते हैं, सपने वो हैं जो आपको सोने नहीं देते!",
        "कठिनाइयाँ आपको तोड़ने नहीं, बल्कि मजबूत बनाने आती हैं!",
        "सफलता छोटे-छोटे प्रयासों का योग है!",
        "आज का समर्पण कल की सफलता की नींव है!",
        "जो सीखता है वही आगे बढ़ता है!",
        "सफलता का कोई शॉर्टकट नहीं, केवल कड़ी मेहनत है!",
        "आपकी मेहनत रंग लाएगी, बस निरंतरता बनाए रखें!"
      ]
    };
    
    // ========== GLOBAL VARIABLES ==========
    const STORAGE_KEYS = {
      PROGRESS: "rrb_ntpc_progress_v2",
      UI_STATE: "rrb_ntpc_ui_v2",
      STUDENT_NAME: "rrb_ntpc_student_name",
      CBT_RESULTS: "rrb_ntpc_cbt_results",
      THEME: "rrb_ntpc_theme",
      STUDY_LOG: "rrb_ntpc_study_log"
    };
    
    let savedProgress = JSON.parse(localStorage.getItem(STORAGE_KEYS.PROGRESS) || "{}");
    let savedUIState = JSON.parse(localStorage.getItem(STORAGE_KEYS.UI_STATE) || "{}");
    let cbtResults = JSON.parse(localStorage.getItem(STORAGE_KEYS.CBT_RESULTS) || "[]");
    let studyLog = JSON.parse(localStorage.getItem(STORAGE_KEYS.STUDY_LOG) || "[]");
    let currentTheme = localStorage.getItem(STORAGE_KEYS.THEME) || "dark";
    let charts = {};
    
    // ========== INITIALIZATION ==========
    function initializeApp() {
      // Set theme
      document.body.className = `theme-${currentTheme}`;
      
      // Initialize welcome screen
      const welcomeScreen = document.getElementById('welcomeScreen');
      const mainApp = document.getElementById('mainApp');
      const nameInput = document.getElementById('studentName');
      const startBtn = document.getElementById('startTracking');
      const studentName = localStorage.getItem(STORAGE_KEYS.STUDENT_NAME) || "";
      
      // Always show welcome screen
      welcomeScreen.style.display = 'flex';
      mainApp.style.display = 'none';
      
      if (studentName) {
        // Returning user
        nameInput.value = studentName;
        nameInput.readOnly = true;
        startBtn.innerHTML = '<i class="fas fa-rocket"></i> Continue Tracking';
        
        // Auto-advance after 2 seconds
        setTimeout(() => {
          if (document.visibilityState === 'visible') {
            startWelcomeTransition();
          }
        }, 2000);
      } else {
        // New user
        nameInput.readOnly = false;
        startBtn.innerHTML = '<i class="fas fa-chart-line"></i> Start Tracking';
      }
      
      // Start button event
      startBtn.onclick = () => {
        const name = nameInput.value.trim();
        if (!studentName && !name) {
          alert('कृपया अपना नाम दर्ज करें!');
          nameInput.focus();
          return;
        }
        
        if (!studentName) {
          localStorage.setItem(STORAGE_KEYS.STUDENT_NAME, name);
        }
        
        startWelcomeTransition();
      };
      
      // Allow pressing Enter in name input
      nameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          startBtn.click();
        }
      });
      
      function startWelcomeTransition() {
        welcomeScreen.classList.add('hidden');
        setTimeout(() => {
          welcomeScreen.style.display = 'none';
          mainApp.style.display = 'block';
          initializeMainApp();
        }, 800);
      }
    }
    
    function initializeMainApp() {
      updateGreeting();
      updateMotivationalMessage();
      renderSubjects();
      updateProgress();
      setupEventListeners();
      initializeCharts();
      loadCBTResults();
      
      // Set up auto-save for study log
      setInterval(saveStudyLog, 60000); // Every minute
      
      // Update time-based elements periodically
      setInterval(updateGreeting, 60000); // Every minute
      setInterval(updateMotivationalMessage, 300000); // Every 5 minutes
    }
    
    // ========== UI FUNCTIONS ==========
    function updateGreeting() {
      const studentName = localStorage.getItem(STORAGE_KEYS.STUDENT_NAME) || "";
      const hour = new Date().getHours();
      let greeting = '';
      
      if (hour < 12) {
        greeting = 'सुप्रभात';
      } else if (hour < 18) {
        greeting = 'नमस्कार';
      } else {
        greeting = 'शुभ संध्या';
      }
      
      document.getElementById('greetingText').textContent = `${greeting}, ${studentName}`;
    }
    
    function updateMotivationalMessage() {
      const messages = CONFIG.motivationalMessages;
      const randomIndex = Math.floor(Math.random() * messages.length);
      document.getElementById('motivationalMessage').textContent = messages[randomIndex];
    }
    
    function renderSubjects() {
      const container = document.getElementById('subjectsContainer');
      container.innerHTML = '';
      
      CONFIG.subjects.forEach(subject => {
        const subjectElement = document.createElement('div');
        subjectElement.className = 'subject';
        subjectElement.dataset.subject = subject.id;
        
        // Calculate progress for this subject
        const progress = calculateSubjectProgress(subject.id);
        const collapsed = savedUIState[subject.id]?.collapsed || false;
        
        // Create header
        const header = document.createElement('div');
        header.className = 'subject-header';
        header.innerHTML = `
          <div class="subject-title">
            <span class="badge ${subject.colorClass}">${subject.title.split(' ')[0]}</span>
            <div><strong>${subject.title}</strong></div>
          </div>
          <div class="progress-wrap">
            <div class="progress-bar">
              <div class="progress-fill" id="bar_${subject.id}" style="width: ${progress}%"></div>
            </div>
            <div class="percent" id="percent_${subject.id}">${Math.round(progress)}%</div>
            <button class="cbt-btn" data-toggle="${subject.id}">
              ${collapsed ? 'विस्तार करें' : 'संकुचित करें'}
            </button>
          </div>
        `;
        
        // Create topics container
        const topicsContainer = document.createElement('div');
        topicsContainer.className = 'topics';
        topicsContainer.id = `topics_${subject.id}`;
        topicsContainer.style.display = collapsed ? 'none' : '';
        
        // Add topics
        subject.topics.forEach(topic => {
          const topicId = `${subject.id}_${topic.id}`;
          const isChecked = savedProgress[topicId] || false;
          
          const topicElement = document.createElement('div');
          topicElement.className = 'topic';
          
          let starClass = '';
          if (topic.stars === 3) starClass = 'three-stars';
          else if (topic.stars === 2) starClass = 'two-stars';
          else if (topic.stars === 1) starClass = 'one-star';
          
          topicElement.innerHTML = `
            <input type="checkbox" id="${topicId}" ${isChecked ? 'checked' : ''}>
            <label for="${topicId}">
              <strong>${topic.name}<span class="stars ${starClass}"></span></strong>
              <small>${topic.hint}</small>
            </label>
            <span class="weight">wt ${topic.weight}</span>
          `;
          
          topicsContainer.appendChild(topicElement);
        });
        
        subjectElement.appendChild(header);
        subjectElement.appendChild(topicsContainer);
        container.appendChild(subjectElement);
      });
      
      // Add event listeners for subject headers
      document.querySelectorAll('.subject-header').forEach(header => {
        header.addEventListener('click', (e) => {
          if (e.target.closest('button')) return; // Don't toggle if clicking the button
          
          const subjectId = e.currentTarget.closest('.subject').dataset.subject;
          const topicsEl = document.getElementById(`topics_${subjectId}`);
          const collapsed = topicsEl.style.display === 'none';
          
          topicsEl.style.display = collapsed ? '' : 'none';
          const btn = e.currentTarget.querySelector(`button[data-toggle="${subjectId}"]`);
          if (btn) btn.textContent = collapsed ? 'संकुचित करें' : 'विस्तार करें';
          
          // Save UI state
          savedUIState[subjectId] = { collapsed: !collapsed };
          localStorage.setItem(STORAGE_KEYS.UI_STATE, JSON.stringify(savedUIState));
        });
      });
      
      // Add event listeners for topic checkboxes
      document.querySelectorAll('.topic input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const topicId = this.id;
          savedProgress[topicId] = this.checked;
          localStorage.setItem(STORAGE_KEYS.PROGRESS, JSON.stringify(savedProgress));
          
          // Update progress
          updateProgress();
          
          // Show congratulations if checked
          if (this.checked) {
            showCongratulations(this);
            
            // Log study activity
            logStudyActivity(topicId);
          }
        });
      });
      
      // Add event listeners for toggle buttons
      document.querySelectorAll('button[data-toggle]').forEach(button => {
        button.addEventListener('click', function(e) {
          e.stopPropagation();
          const subjectId = this.dataset.toggle;
          const topicsEl = document.getElementById(`topics_${subjectId}`);
          const collapsed = topicsEl.style.display === 'none';
          
          topicsEl.style.display = collapsed ? '' : 'none';
          this.textContent = collapsed ? 'संकुचित करें' : 'विस्तार करें';
          
          // Save UI state
          savedUIState[subjectId] = { collapsed: !collapsed };
          localStorage.setItem(STORAGE_KEYS.UI_STATE, JSON.stringify(savedUIState));
        });
      });
    }
    
    function calculateSubjectProgress(subjectId) {
      const subject = CONFIG.subjects.find(s => s.id === subjectId);
      if (!subject) return 0;
      
      let totalWeight = 0;
      let completedWeight = 0;
      
      subject.topics.forEach(topic => {
        const topicId = `${subject.id}_${topic.id}`;
        totalWeight += topic.weight;
        if (savedProgress[topicId]) {
          completedWeight += topic.weight;
        }
      });
      
      return totalWeight > 0 ? (completedWeight / totalWeight) * 100 : 0;
    }
    
    function calculateOverallProgress() {
      let totalWeight = 0;
      let completedWeight = 0;
      
      CONFIG.subjects.forEach(subject => {
        subject.topics.forEach(topic => {
          const topicId = `${subject.id}_${topic.id}`;
          totalWeight += topic.weight;
          if (savedProgress[topicId]) {
            completedWeight += topic.weight;
          }
        });
      });
      
      return totalWeight > 0 ? (completedWeight / totalWeight) * 100 : 0;
    }
    
    function updateProgress() {
      // Update overall progress
      const overallProgress = calculateOverallProgress();
      document.getElementById('totalProgress').textContent = `(${Math.round(overallProgress)}% पूर्ण)`;
      
      // Update donut chart
      const donut = document.getElementById('donutOverall');
      const circumference = 2 * Math.PI * 85;
      const offset = circumference * (1 - overallProgress / 100);
      donut.setAttribute('stroke-dasharray', circumference);
      donut.setAttribute('stroke-dashoffset', offset);
      document.getElementById('overallText').textContent = `${Math.round(overallProgress)}%`;
      
      // Update subject progress bars and percentages
      CONFIG.subjects.forEach(subject => {
        const progress = calculateSubjectProgress(subject.id);
        const progressBar = document.getElementById(`bar_${subject.id}`);
        const percentText = document.getElementById(`percent_${subject.id}`);
        
        if (progressBar) progressBar.style.width = `${progress}%`;
        if (percentText) percentText.textContent = `${Math.round(progress)}%`;
      });
      
      // Update subject charts
      updateSubjectCharts();
      
      // Update performance charts
      updatePerformanceCharts();
    }
    
    function updateSubjectCharts() {
      const container = document.getElementById('subjectCharts');
      container.innerHTML = '';
      
      // Show top 6 subjects by progress
      const subjectsWithProgress = CONFIG.subjects.map(subject => ({
        ...subject,
        progress: calculateSubjectProgress(subject.id)
      })).sort((a, b) => b.progress - a.progress).slice(0, 6);
      
      subjectsWithProgress.forEach(subject => {
        const chartCard = document.createElement('div');
        chartCard.className = 'chart-card';
        
        // Create donut SVG
        const donutSize = 100;
        const radius = 40;
        const circumference = 2 * Math.PI * radius;
        const offset = circumference * (1 - subject.progress / 100);
        
        chartCard.innerHTML = `
          <svg class="donut" viewBox="0 0 100 100" width="100" height="100">
            <circle cx="50" cy="50" r="${radius}" fill="none" stroke="var(--border)" stroke-width="15"/>
            <circle cx="50" cy="50" r="${radius}" fill="none" stroke="var(--accent)" stroke-width="15" stroke-linecap="round"
              stroke-dasharray="${circumference}" stroke-dashoffset="${offset}"/>
            <text x="50" y="55" text-anchor="middle" font-size="14" font-weight="800" fill="var(--text)">${Math.round(subject.progress)}%</text>
          </svg>
          <div class="progress-bar" style="width:100px">
            <div class="progress-fill" style="width: ${subject.progress}%"></div>
          </div>
          <div class="subject-names">${subject.title.split('(')[0].trim()}</div>
        `;
        
        container.appendChild(chartCard);
      });
    }
    
    function showCongratulations(checkbox) {
      const topicId = checkbox.id;
      const [subjectId, topicKey] = topicId.split('_');
      
      const subject = CONFIG.subjects.find(s => s.id === subjectId);
      if (!subject) return;
      
      const topic = subject.topics.find(t => t.id === topicKey);
      if (!topic) return;
      
      // Update congratulation message
      const messages = [
        `बधाई हो! आपने "${topic.name}" पूरा किया है!`,
        `शानदार! "${topic.name}" अब पूरा हुआ!`,
        `अद्भुत! आपने "${topic.name}" सफलतापूर्वक पूरा किया!`,
        `वाह! "${topic.name}" पूरा करने के लिए बधाई!`
      ];
      
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      document.getElementById('congratsMessage').textContent = randomMessage;
      
      // Show modal
      document.getElementById('congratsModal').classList.add('active');
      
      // Launch confetti
      launchConfetti();
    }
    
    function launchConfetti() {
      // Main burst
      confetti({
        particleCount: 150,
        spread: 70,
        origin: { y: 0.6 },
        colors: ['#6366f1', '#10b981', '#ec4899', '#f59e0b', '#8b5cf6']
      });
      
      // Left side
      setTimeout(() => {
        confetti({
          particleCount: 100,
          angle: 60,
          spread: 55,
          origin: { x: 0 },
          colors: ['#ec4899', '#f59e0b']
        });
      }, 250);
      
      // Right side
      setTimeout(() => {
        confetti({
          particleCount: 100,
          angle: 120,
          spread: 55,
          origin: { x: 1 },
          colors: ['#6366f1', '#10b981', '#8b5cf6']
        });
      }, 500);
      
      // Additional bursts
      setTimeout(() => {
        confetti({
          particleCount: 200,
          spread: 100,
          origin: { y: 0.5 },
          colors: ['#6366f1', '#10b981', '#ec4899', '#f59e0b', '#8b5cf6']
        });
      }, 750);
    }
    
    // ========== CBT ANALYSIS FUNCTIONS ==========
    function loadCBTResults() {
      const latestPerformance = document.getElementById('latestPerformance');
      
      if (cbtResults.length === 0) {
        latestPerformance.innerHTML = '<p style="text-align: center; color: var(--muted); padding: 30px;">अभी तक कोई टेस्ट डेटा नहीं है। पहला टेस्ट एंट्री जोड़ें।</p>';
        return;
      }
      
      // Sort by date (newest first)
      cbtResults.sort((a, b) => new Date(b.date) - new Date(a.date));
      const latest = cbtResults[0];
      
      const percentage = ((latest.total / 300) * 100).toFixed(1);
      const date = new Date(latest.date).toLocaleDateString('hi-IN');
      
      latestPerformance.innerHTML = `
        <div style="text-align: center;">
          <h3 style="color: var(--accent); margin-bottom: 15px;">${latest.name}</h3>
          <div style="font-size: 2.5rem; font-weight: 800; color: var(--accent); margin: 15px 0;">${percentage}%</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
            <div style="background: rgba(99,102,241,0.1); padding: 15px; border-radius: 12px;">
              <div style="font-size: 0.9rem; color: var(--muted);">गणित</div>
              <div style="font-size: 1.5rem; font-weight: 800;">${latest.math}</div>
            </div>
            <div style="background: rgba(16,185,129,0.1); padding: 15px; border-radius: 12px;">
              <div style="font-size: 0.9rem; color: var(--muted);">रीजनिंग</div>
              <div style="font-size: 1.5rem; font-weight: 800;">${latest.reasoning}</div>
            </div>
            <div style="background: rgba(245,158,11,0.1); padding: 15px; border-radius: 12px;">
              <div style="font-size: 0.9rem; color: var(--muted);">सामान्य जागरूकता</div>
              <div style="font-size: 1.5rem; font-weight: 800;">${latest.gs}</div>
            </div>
            <div style="background: rgba(139,92,246,0.1); padding: 15px; border-radius: 12px;">
              <div style="font-size: 0.9rem; color: var(--muted);">कुल अंक</div>
              <div style="font-size: 1.5rem; font-weight: 800;">${latest.total}/300</div>
            </div>
          </div>
          <div style="color: var(--muted); font-size: 0.9rem;">तारीख: ${date}</div>
        </div>
      `;
      
      // Update performance chart
      updatePerformanceChart();
    }
    
    function updatePerformanceChart() {
      const ctx = document.getElementById('performanceChart').getContext('2d');
      
      // Destroy existing chart if it exists
      if (charts.performance) {
        charts.performance.destroy();
      }
      
      // Prepare data
      const labels = cbtResults.map(r => r.name).slice(-10); // Last 10 tests
      const mathScores = cbtResults.map(r => r.math).slice(-10);
      const reasoningScores = cbtResults.map(r => r.reasoning).slice(-10);
      const gsScores = cbtResults.map(r => r.gs).slice(-10);
      const totalScores = cbtResults.map(r => r.total).slice(-10);
      
      // Create chart
      charts.performance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'गणित',
              data: mathScores,
              borderColor: '#6366f1',
              backgroundColor: 'rgba(99, 102, 241, 0.1)',
              tension: 0.3,
              fill: false
            },
            {
              label: 'रीजनिंग',
              data: reasoningScores,
              borderColor: '#10b981',
              backgroundColor: 'rgba(16, 185, 129, 0.1)',
              tension: 0.3,
              fill: false
            },
            {
              label: 'सामान्य जागरूकता',
              data: gsScores,
              borderColor: '#f59e0b',
              backgroundColor: 'rgba(245, 158, 11, 0.1)',
              tension: 0.3,
              fill: false
            },
            {
              label: 'कुल अंक',
              data: totalScores,
              borderColor: '#8b5cf6',
              backgroundColor: 'rgba(139, 92, 246, 0.1)',
              tension: 0.3,
              fill: false,
              borderDash: [5, 5]
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: 'var(--text)',
                font: {
                  size: 12
                }
              }
            },
            title: {
              display: true,
              text: 'टेस्ट प्रदर्शन ट्रेंड',
              color: 'var(--text)',
              font: {
                size: 16,
                weight: 'bold'
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: 'var(--muted)',
                maxRotation: 45
              },
              grid: {
                color: 'var(--border)'
              }
            },
            y: {
              beginAtZero: true,
              max: 300,
              ticks: {
                color: 'var(--muted)'
              },
              grid: {
                color: 'var(--border)'
              }
            }
          }
        }
      });
    }
    
    function updatePerformanceCharts() {
      // Update subject progress chart
      updateSubjectProgressChart();
      
      // Update topic coverage chart
      updateTopicCoverageChart();
      
      // Update study trend chart
      updateStudyTrendChart();
    }
    
    function updateSubjectProgressChart() {
      const ctx = document.getElementById('subjectProgressChart').getContext('2d');
      
      // Destroy existing chart if it exists
      if (charts.subjectProgress) {
        charts.subjectProgress.destroy();
      }
      
      // Prepare data
      const subjects = CONFIG.subjects.map(s => s.title.split('(')[0].trim());
      const progress = CONFIG.subjects.map(s => calculateSubjectProgress(s.id));
      const colors = CONFIG.subjects.map(s => {
        switch(s.colorClass) {
          case 'math': return '#6366f1';
          case 'reasoning': return '#10b981';
          case 'history': return '#f59e0b';
          case 'polity': return '#ec4899';
          case 'geography': return '#8b5cf6';
          case 'economy': return '#10b981';
          case 'static-gk': return '#06b6d4';
          case 'science': return '#f97316';
          case 'computer': return '#6366f1';
          default: return '#94a3b8';
        }
      });
      
      // Create chart
      charts.subjectProgress = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: subjects,
          datasets: [{
            label: 'प्रगति %',
            data: progress,
            backgroundColor: colors,
            borderColor: colors.map(c => c.replace('0.8', '1')),
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            },
            title: {
              display: true,
              text: 'विषयवार प्रगति',
              color: 'var(--text)',
              font: {
                size: 16,
                weight: 'bold'
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: 'var(--muted)',
                maxRotation: 45
              },
              grid: {
                color: 'var(--border)'
              }
            },
            y: {
              beginAtZero: true,
              max: 100,
              ticks: {
                color: 'var(--muted)',
                callback: function(value) {
                  return value + '%';
                }
              },
              grid: {
                color: 'var(--border)'
              }
            }
          }
        }
      });
    }
    
    function updateTopicCoverageChart() {
      const ctx = document.getElementById('topicCoverageChart').getContext('2d');
      
      // Destroy existing chart if it exists
      if (charts.topicCoverage) {
        charts.topicCoverage.destroy();
      }
      
      // Calculate completed and pending topics per subject
      const subjects = CONFIG.subjects.map(s => s.title.split('(')[0].trim());
      const completed = CONFIG.subjects.map(subject => {
        return subject.topics.filter(topic => {
          const topicId = `${subject.id}_${topic.id}`;
          return savedProgress[topicId];
        }).length;
      });
      
      const pending = CONFIG.subjects.map(subject => {
        return subject.topics.length - completed[CONFIG.subjects.indexOf(subject)];
      });
      
      // Create chart
      charts.topicCoverage = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['पूर्ण', 'शेष'],
          datasets: [{
            data: [
              completed.reduce((a, b) => a + b, 0),
              pending.reduce((a, b) => a + b, 0)
            ],
            backgroundColor: ['#10b981', 'var(--border)'],
            borderColor: ['#10b981', 'var(--border)'],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: 'var(--text)',
                font: {
                  size: 12
                }
              }
            },
            title: {
              display: true,
              text: 'कुल टॉपिक कवरेज',
              color: 'var(--text)',
              font: {
                size: 16,
                weight: 'bold'
              }
            }
          }
        }
      });
    }
    
    function updateStudyTrendChart() {
      const ctx = document.getElementById('studyTrendChart').getContext('2d');
      
      // Destroy existing chart if it exists
      if (charts.studyTrend) {
        charts.studyTrend.destroy();
      }
      
      // Prepare study log data (last 7 days)
      const last7Days = Array.from({length: 7}, (_, i) => {
        const date = new Date();
        date.setDate(date.getDate() - (6 - i));
        return date.toLocaleDateString('hi-IN', { weekday: 'short' });
      });
      
      const studyData = Array(7).fill(0);
      
      studyLog.forEach(entry => {
        const entryDate = new Date(entry.date);
        const today = new Date();
        const diffDays = Math.floor((today - entryDate) / (1000 * 60 * 60 * 24));
        
        if (diffDays >= 0 && diffDays < 7) {
          studyData[6 - diffDays] += entry.topics.length;
        }
      });
      
      // Create chart
      charts.studyTrend = new Chart(ctx, {
        type: 'line',
        data: {
          labels: last7Days,
          datasets: [{
            label: 'टॉपिक्स पूर्ण किए',
            data: studyData,
            borderColor: '#6366f1',
            backgroundColor: 'rgba(99, 102, 241, 0.1)',
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: 'var(--text)',
                font: {
                  size: 12
                }
              }
            },
            title: {
              display: true,
              text: 'साप्ताहिक अध्ययन ट्रेंड',
              color: 'var(--text)',
              font: {
                size: 16,
                weight: 'bold'
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: 'var(--muted)'
              },
              grid: {
                color: 'var(--border)'
              }
            },
            y: {
              beginAtZero: true,
              ticks: {
                color: 'var(--muted)'
              },
              grid: {
                color: 'var(--border)'
              }
            }
          }
        }
      });
    }
    
    function logStudyActivity(topicId) {
      const today = new Date().toDateString();
      const todayLog = studyLog.find(log => new Date(log.date).toDateString() === today);
      
      if (todayLog) {
        if (!todayLog.topics.includes(topicId)) {
          todayLog.topics.push(topicId);
        }
      } else {
        studyLog.push({
          date: new Date().toISOString(),
          topics: [topicId]
        });
      }
      
      // Keep only last 30 days
      const thirtyDaysAgo = new Date();
      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
      studyLog = studyLog.filter(log => new Date(log.date) >= thirtyDaysAgo);
      
      localStorage.setItem(STORAGE_KEYS.STUDY_LOG, JSON.stringify(studyLog));
    }
    
    function saveStudyLog() {
      localStorage.setItem(STORAGE_KEYS.STUDY_LOG, JSON.stringify(studyLog));
    }
    
    // ========== EVENT LISTENERS SETUP ==========
    function setupEventListeners() {
      // Drawer menu
      document.getElementById('menuBtn').addEventListener('click', () => {
        document.getElementById('drawer').classList.add('active');
        document.getElementById('drawerOverlay').classList.add('active');
      });
      
      document.getElementById('drawerClose').addEventListener('click', closeDrawer);
      document.getElementById('drawerOverlay').addEventListener('click', closeDrawer);
      
      // Theme buttons
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const theme = this.dataset.theme;
          setTheme(theme);
          
          // Update active button
          document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
        });
      });
      
      // Tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const tabId = this.dataset.tab;
          
          // Update active tab button
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          // Show corresponding tab content
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
          });
          document.getElementById(`${tabId}-tab`).classList.add('active');
        });
      });
      
      // CBT buttons
      document.querySelectorAll('.cbt-btn[data-cbt]').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.cbt-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          // In a full implementation, this would filter CBT results
        });
      });
      
      // CBT form submission
      document.getElementById('cbtForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const testData = {
          name: document.getElementById('testName').value,
          date: document.getElementById('testDate').value,
          math: parseInt(document.getElementById('mathMarks').value),
          reasoning: parseInt(document.getElementById('reasoningMarks').value),
          gs: parseInt(document.getElementById('gsMarks').value),
          total: parseInt(document.getElementById('totalMarks').value)
        };
        
        cbtResults.push(testData);
        localStorage.setItem(STORAGE_KEYS.CBT_RESULTS, JSON.stringify(cbtResults));
        
        // Reset form
        this.reset();
        document.getElementById('testDate').valueAsDate = new Date();
        
        // Update display
        loadCBTResults();
        
        // Show success message
        alert('टेस्ट डेटा सफलतापूर्वक सेव हो गया!');
      });
      
      // Control buttons
      document.getElementById('expandAll').addEventListener('click', () => {
        CONFIG.subjects.forEach(subject => {
          const topicsEl = document.getElementById(`topics_${subject.id}`);
          topicsEl.style.display = '';
          const btn = document.querySelector(`button[data-toggle="${subject.id}"]`);
          if (btn) btn.textContent = 'संकुचित करें';
          
          savedUIState[subject.id] = { collapsed: false };
        });
        localStorage.setItem(STORAGE_KEYS.UI_STATE, JSON.stringify(savedUIState));
      });
      
      document.getElementById('collapseAll').addEventListener('click', () => {
        CONFIG.subjects.forEach(subject => {
          const topicsEl = document.getElementById(`topics_${subject.id}`);
          topicsEl.style.display = 'none';
          const btn = document.querySelector(`button[data-toggle="${subject.id}"]`);
          if (btn) btn.textContent = 'विस्तार करें';
          
          savedUIState[subject.id] = { collapsed: true };
        });
        localStorage.setItem(STORAGE_KEYS.UI_STATE, JSON.stringify(savedUIState));
      });
      
      document.getElementById('markAll').addEventListener('click', () => {
        CONFIG.subjects.forEach(subject => {
          subject.topics.forEach(topic => {
            const topicId = `${subject.id}_${topic.id}`;
            savedProgress[topicId] = true;
            const checkbox = document.getElementById(topicId);
            if (checkbox) checkbox.checked = true;
          });
        });
        localStorage.setItem(STORAGE_KEYS.PROGRESS, JSON.stringify(savedProgress));
        updateProgress();
      });
      
      document.getElementById('unmarkAll').addEventListener('click', () => {
        CONFIG.subjects.forEach(subject => {
          subject.topics.forEach(topic => {
            const topicId = `${subject.id}_${topic.id}`;
            savedProgress[topicId] = false;
            const checkbox = document.getElementById(topicId);
            if (checkbox) checkbox.checked = false;
          });
        });
        localStorage.setItem(STORAGE_KEYS.PROGRESS, JSON.stringify(savedProgress));
        updateProgress();
      });
      
      // Reset button
      document.getElementById('resetBtn').addEventListener('click', () => {
        document.getElementById('resetModal').classList.add('active');
      });
      
      document.getElementById('resetCancel').addEventListener('click', () => {
        document.getElementById('resetModal').classList.remove('active');
        document.getElementById('resetConfirmInput').value = '';
        document.getElementById('resetConfirm').disabled = true;
      });
      
      document.getElementById('resetConfirmInput').addEventListener('input', function() {
        document.getElementById('resetConfirm').disabled = 
          this.value !== 'RESET MY PROGRESS';
      });
      
      document.getElementById('resetConfirm').addEventListener('click', () => {
        // Clear all progress data
        savedProgress = {};
        cbtResults = [];
        studyLog = [];
        
        localStorage.setItem(STORAGE_KEYS.PROGRESS, JSON.stringify(savedProgress));
        localStorage.setItem(STORAGE_KEYS.CBT_RESULTS, JSON.stringify(cbtResults));
        localStorage.setItem(STORAGE_KEYS.STUDY_LOG, JSON.stringify(studyLog));
        
        // Reset checkboxes
        document.querySelectorAll('.topic input[type="checkbox"]').forEach(checkbox => {
          checkbox.checked = false;
        });
        
        // Update UI
        updateProgress();
        loadCBTResults();
        
        // Close modal
        document.getElementById('resetModal').classList.remove('active');
        document.getElementById('resetConfirmInput').value = '';
        document.getElementById('resetConfirm').disabled = true;
        
        alert('सभी प्रोग्रेस रीसेट हो गया है!');
      });
      
      // Export/Import buttons
      document.getElementById('exportBackupBtn').addEventListener('click', exportBackup);
      document.getElementById('importBackupBtn').addEventListener('click', () => {
        document.getElementById('importFile').click();
      });
      
      document.getElementById('importFile').addEventListener('change', importBackup);
      
      // Close congratulations modal
      document.getElementById('closeCongrats').addEventListener('click', () => {
        document.getElementById('congratsModal').classList.remove('active');
      });
      
      // Set today's date as default in CBT form
      document.getElementById('testDate').valueAsDate = new Date();
    }
    
    function closeDrawer() {
      document.getElementById('drawer').classList.remove('active');
      document.getElementById('drawerOverlay').classList.remove('active');
    }
    
    function setTheme(theme) {
      currentTheme = theme;
      document.body.className = `theme-${theme}`;
      localStorage.setItem(STORAGE_KEYS.THEME, theme);
      
      // Update theme toggle button icon
      const themeToggle = document.getElementById('themeToggle');
      themeToggle.innerHTML = theme === 'dark' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
      
      // Update charts if they exist
      setTimeout(() => {
        if (charts.performance) updatePerformanceChart();
        if (charts.subjectProgress) updateSubjectProgressChart();
        if (charts.topicCoverage) updateTopicCoverageChart();
        if (charts.studyTrend) updateStudyTrendChart();
      }, 100);
    }
    
    // ========== BACKUP FUNCTIONS ==========
    function exportBackup() {
      const backupData = {
        app: 'RRB NTPC Syllabus Tracker',
        version: CONFIG.appVersion,
        timestamp: new Date().toISOString(),
        studentName: localStorage.getItem(STORAGE_KEYS.STUDENT_NAME),
        progress: savedProgress,
        uiState: savedUIState,
        cbtResults: cbtResults,
        studyLog: studyLog,
        theme: currentTheme
      };
      
      const dataStr = JSON.stringify(backupData, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `rrb_ntpc_backup_${new Date().toISOString().slice(0,10)}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('बैकअप सफलतापूर्वक एक्सपोर्ट हो गया!');
    }
    
    function importBackup(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const backupData = JSON.parse(e.target.result);
          
          // Validate backup file
          if (!backupData.app || !backupData.version) {
            throw new Error('Invalid backup file');
          }
          
          // Import data
          if (backupData.studentName) {
            localStorage.setItem(STORAGE_KEYS.STUDENT_NAME, backupData.studentName);
          }
          
          if (backupData.progress) {
            savedProgress = backupData.progress;
            localStorage.setItem(STORAGE_KEYS.PROGRESS, JSON.stringify(savedProgress));
          }
          
          if (backupData.uiState) {
            savedUIState = backupData.uiState;
            localStorage.setItem(STORAGE_KEYS.UI_STATE, JSON.stringify(savedUIState));
          }
          
          if (backupData.cbtResults) {
            cbtResults = backupData.cbtResults;
            localStorage.setItem(STORAGE_KEYS.CBT_RESULTS, JSON.stringify(cbtResults));
          }
          
          if (backupData.studyLog) {
            studyLog = backupData.studyLog;
            localStorage.setItem(STORAGE_KEYS.STUDY_LOG, JSON.stringify(studyLog));
          }
          
          if (backupData.theme) {
            currentTheme = backupData.theme;
            localStorage.setItem(STORAGE_KEYS.THEME, currentTheme);
            setTheme(currentTheme);
          }
          
          // Update UI
          updateGreeting();
          renderSubjects();
          updateProgress();
          loadCBTResults();
          
          alert('बैकअप सफलतापूर्वक इम्पोर्ट हो गया!');
        } catch (error) {
          alert('बैकअप फ़ाइल अमान्य है। कृपया एक वैध बैकअप फ़ाइल चुनें।');
          console.error('Import error:', error);
        }
      };
      
      reader.readAsText(file);
      event.target.value = ''; // Reset file input
    }
    
    function initializeCharts() {
      // Initialize empty charts
      updatePerformanceChart();
      updateSubjectProgressChart();
      updateTopicCoverageChart();
      updateStudyTrendChart();
    }
    
    // ========== INITIALIZE APP ==========
    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
</body>
</html>
